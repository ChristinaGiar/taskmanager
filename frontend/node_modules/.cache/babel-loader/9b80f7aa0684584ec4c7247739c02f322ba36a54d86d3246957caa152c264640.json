{"ast":null,"code":"var _jsxFileName = \"/Users/cgiaramani/AEM-projects/to-do-mine/frontend/src/pages/AuthPage.js\",\n  _s = $RefreshSig$();\nimport React from 'react';\nimport { Form, json, Link, redirect, useActionData, useSearchParams } from 'react-router-dom';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport const authAction = async _ref => {\n  var _response;\n  let {\n    params,\n    request\n  } = _ref;\n  let searchParams = new URL(request.url).searchParams;\n  let isLogin = searchParams.get('mode') === 'login';\n  let mode = searchParams.get('mode') === 'login' ? 'login' : 'signup';\n  console.log(\"isLogin: \");\n  let formData = await request.formData();\n  const data = {\n    email: formData.get('email'),\n    password: formData.get('password')\n  };\n  console.log(data);\n  console.log(\"isLogin: \", isLogin, formData);\n  const errors = {};\n\n  // validate the fields\n  if (typeof data.email !== \"string\" || !data.email.includes(\"@\")) {\n    errors.email = \"That doesn't look like an email address\";\n  }\n  if (typeof data.password !== \"string\" || data.password.length < 6) {\n    errors.password = \"Password must be > 6 characters\";\n  }\n  console.log(errors);\n  // return data if we have errors\n  if (Object.keys(errors).length) {\n    return errors;\n  }\n  console.log('http://localhost:8080/' + mode);\n  /*let result;\n      try {\n        // const response = await fetch('https://website');\n        result = await fetch('http://localhost:8080/' + mode, {\n          method: \"POST\",\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify(data),\n        })\n      } catch (error) {\n        // TypeError: Failed to fetch\n        console.log('There was an error', error);\n      }*/\n  let response;\n  try {\n    response = await fetch('http://localhost:8080/' + mode, {\n      method: \"POST\",\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify(data)\n    });\n  } catch (error) {\n    console.log('There was an error', error);\n  }\n\n  // Uses the 'optional chaining' operator\n  if ((_response = response) !== null && _response !== void 0 && _response.ok) {\n    console.log('Use the response here!');\n  } else {\n    var _response2;\n    if (response.status === 442 || response.status === 401 || response.status) {\n      // return response;\n      console.log(\"response.serverErrors\", response.serverErrors);\n      return [response.serverErrors, redirect(\"/auth?mode=\" + mode)];\n    }\n    if (!response.ok) {\n      throw json({\n        message: 'Could not authenticate user.'\n      }, {\n        status: 500\n      });\n    }\n    return redirect(\"/auth?mode=\" + mode);\n    console.log(`HTTP Response Code: ${(_response2 = response) === null || _response2 === void 0 ? void 0 : _response2.status}`);\n  }\n\n  /*\n      if(result.status === 442 || result.status === 401 || result.status) {\n        // return result;\n      return redirect(\"/post\");\n  \n        return result.serverErrors;\n      }\n      if (!result.ok) {\n        throw json({ message:'Could not authenticate user.' }, { status: 500 })\n      }\n  \n      const resData = await result.json();\n      const token = resData.token;\n      localStorage.setItem('token', token);\n      const expiration = new Date().getTime() + 60 * 60 * 1000;\n      // console.log(new Date().getTime(), expiration, new Date(expiration).toISOString());\n      localStorage.setItem('expiration-token', new Date(expiration).toISOString());\n  \n    \n      // // otherwise create the user and redirect\n      // await createUser(email, password);\n      return redirect(\"/\");\n      */\n  // return formData; /// HOW to redirect & pass input data??\n};\n\nconst AuthPage = () => {\n  _s();\n  var _errors, _errors2;\n  let errors = useActionData();\n  if (Array.isArray(errors)) {\n    errors = errors[0];\n  }\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: /*#__PURE__*/_jsxDEV(Form, {\n      method: \"post\",\n      children: [/*#__PURE__*/_jsxDEV(\"label\", {\n        htmlFor: \"email\",\n        children: \"Email\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 114,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        id: \"email\",\n        name: \"email\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 115,\n        columnNumber: 9\n      }, this), ((_errors = errors) === null || _errors === void 0 ? void 0 : _errors.email) && /*#__PURE__*/_jsxDEV(\"div\", {\n        children: errors.email\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 27\n      }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n        htmlFor: \"password\",\n        children: \"Password\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        id: \"password\",\n        name: \"password\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 121,\n        columnNumber: 9\n      }, this), ((_errors2 = errors) === null || _errors2 === void 0 ? void 0 : _errors2.password) && /*#__PURE__*/_jsxDEV(\"div\", {\n        children: errors.password\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 122,\n        columnNumber: 30\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        children: \"Login\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 123,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 7\n    }, this)\n  }, void 0, false);\n};\n_s(AuthPage, \"MXG3vJWOluRyotNja3c0q7lD6Co=\", false, function () {\n  return [useActionData];\n});\n_c = AuthPage;\nexport default AuthPage;\nvar _c;\n$RefreshReg$(_c, \"AuthPage\");","map":{"version":3,"names":["React","Form","json","Link","redirect","useActionData","useSearchParams","authAction","params","request","searchParams","URL","url","isLogin","get","mode","console","log","formData","data","email","password","errors","includes","length","Object","keys","response","fetch","method","headers","body","JSON","stringify","error","ok","status","serverErrors","message","AuthPage","Array","isArray"],"sources":["/Users/cgiaramani/AEM-projects/to-do-mine/frontend/src/pages/AuthPage.js"],"sourcesContent":["import React from 'react';\nimport { Form, json, Link, redirect, useActionData, useSearchParams } from 'react-router-dom';\n\nexport const authAction = async ({ params, request }) => {\n\n  let searchParams = new URL(request.url).searchParams;\n  let isLogin = searchParams.get('mode') === 'login';\n  let mode = searchParams.get('mode') === 'login' ? 'login' : 'signup';\n  console.log(\"isLogin: \");\n\n  let formData = await request.formData();\n  const data = {\n    email: formData.get('email'),\n    password: formData.get('password'),\n  };\n  console.log(data);\n  console.log(\"isLogin: \", isLogin, formData);\n\n  const errors = {};\n\n  // validate the fields\n  if (typeof data.email !== \"string\" || !data.email.includes(\"@\")) {\n    errors.email =\n      \"That doesn't look like an email address\";\n  }\n\n  if (typeof data.password !== \"string\" || data.password.length < 6) {\n    errors.password = \"Password must be > 6 characters\";\n  }\n  console.log(errors);\n  // return data if we have errors\n  if (Object.keys(errors).length) {\n    return errors;\n  }\n  console.log('http://localhost:8080/' + mode);\n  /*let result;\n      try {\n        // const response = await fetch('https://website');\n        result = await fetch('http://localhost:8080/' + mode, {\n          method: \"POST\",\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify(data),\n        })\n      } catch (error) {\n        // TypeError: Failed to fetch\n        console.log('There was an error', error);\n      }*/\n  let response;\n\n  try {\n    response = await fetch('http://localhost:8080/' + mode, {\n      method: \"POST\",\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify(data),\n    })\n  } catch (error) {\n    console.log('There was an error', error);\n  }\n\n  // Uses the 'optional chaining' operator\n  if (response?.ok) {\n    console.log('Use the response here!');\n  } else {\n    if (response.status === 442 || response.status === 401 || response.status) {\n      // return response;\n      console.log(\"response.serverErrors\", response.serverErrors);\n      return [response.serverErrors, redirect(\"/auth?mode=\" + mode)];\n    }\n    if (!response.ok) {\n      throw json({ message: 'Could not authenticate user.' }, { status: 500 })\n    }\n    return redirect(\"/auth?mode=\" + mode);\n    console.log(`HTTP Response Code: ${response?.status}`)\n  }\n\n  /*\n      if(result.status === 442 || result.status === 401 || result.status) {\n        // return result;\n      return redirect(\"/post\");\n  \n        return result.serverErrors;\n      }\n      if (!result.ok) {\n        throw json({ message:'Could not authenticate user.' }, { status: 500 })\n      }\n  \n      const resData = await result.json();\n      const token = resData.token;\n      localStorage.setItem('token', token);\n      const expiration = new Date().getTime() + 60 * 60 * 1000;\n      // console.log(new Date().getTime(), expiration, new Date(expiration).toISOString());\n      localStorage.setItem('expiration-token', new Date(expiration).toISOString());\n  \n    \n      // // otherwise create the user and redirect\n      // await createUser(email, password);\n      return redirect(\"/\");\n      */\n  // return formData; /// HOW to redirect & pass input data??\n}\n\nconst AuthPage = () => {\n  let errors = useActionData();\n  if(Array.isArray(errors)) {\n    errors = errors[0];\n  }\n  return (\n    <>\n      <Form method=\"post\">\n        <label htmlFor='email'>Email</label>\n        <input id=\"email\" name=\"email\"></input>\n        {errors?.email && <div>{errors.email}</div>}\n        {/* {errors[0]?.email && <div>{errors[0].email}</div>} */}\n        {/* {serverErrors?.email && <div>{serverErrors.email}</div>} */}\n        <label htmlFor='password'>Password</label>\n\n        <input id=\"password\" name=\"password\"></input>\n        {errors?.password && <div>{errors.password}</div>}\n        <button>Login</button>\n      </Form>\n    </>\n  )\n}\n\nexport default AuthPage;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}