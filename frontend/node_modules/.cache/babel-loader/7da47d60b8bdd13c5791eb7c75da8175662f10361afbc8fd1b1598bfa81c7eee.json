{"ast":null,"code":"var _jsxFileName = \"/Users/cgiaramani/AEM-projects/to-do-mine/frontend/src/pages/AuthPage.js\",\n  _s = $RefreshSig$();\nimport React from 'react';\nimport { Form, redirect, json, useActionData, useLocation } from 'react-router-dom';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport const authAction = async _ref => {\n  let {\n    params,\n    request\n  } = _ref;\n  let searchParams = new URL(request.url).searchParams;\n  let isLogin = searchParams.get('mode') === 'login';\n  let mode = searchParams.get('mode') === 'login' ? 'login' : 'signup';\n  let formData = await request.formData();\n  const data = {\n    email: formData.get('email'),\n    password: formData.get('password')\n  };\n  if (formData.get('name')) {\n    data.name = formData.get('name');\n  }\n  const errors = {};\n\n  // validate the fields\n  if (typeof data.email !== \"string\" || !data.email.includes(\"@\")) {\n    errors.email = \"That doesn't look like an email address\";\n  }\n  if (typeof data.password !== \"string\" || data.password.length < 6) {\n    errors.password = \"Password must be > 6 characters\";\n  }\n  if (Object.keys(errors).length) {\n    return errors;\n  }\n  let response;\n  response = await fetch('http://localhost:8080/' + mode, {\n    method: \"POST\",\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify(data)\n  });\n  const resData = await response.json();\n  if (response.status === 422 || response.status === 401) {\n    return resData;\n    // return resData.serverErrors;\n  }\n\n  if (!response.ok) {\n    throw json({\n      message: 'Could not authenticate user.'\n    }, {\n      status: 500\n    });\n  }\n  const token = resData.token;\n  localStorage.setItem('token', token);\n  const expiration = new Date().getTime() + 60 * 60 * 1000;\n  localStorage.setItem('token-duration', new Date(expiration).toISOString());\n  const name = resData.user.name;\n  localStorage.setItem('name', name);\n\n  // otherwise create the user and redirect\n  return redirect(\"/\");\n};\nconst AuthPage = () => {\n  _s();\n  var _data$errors, _data$serverErrors, _data$errors2, _data$serverErrors2;\n  let data = useActionData();\n  const location = useLocation();\n  const searchParams = new URLSearchParams(location.search);\n  let isLogin = searchParams.get('mode') === 'login';\n  // let mode = searchParams.get('mode') === 'login' ? 'login' : 'signup';\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: /*#__PURE__*/_jsxDEV(Form, {\n      method: \"post\",\n      children: [(data === null || data === void 0 ? void 0 : data.serverError) && /*#__PURE__*/_jsxDEV(\"div\", {\n        children: data.serverError\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 76,\n        columnNumber: 29\n      }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n        htmlFor: \"email\",\n        children: \"Email\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 78,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        id: \"email\",\n        name: \"email\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 79,\n        columnNumber: 9\n      }, this), ((_data$errors = data.errors) === null || _data$errors === void 0 ? void 0 : _data$errors.email) && /*#__PURE__*/_jsxDEV(\"div\", {\n        children: data.errors.email\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 80,\n        columnNumber: 32\n      }, this), ((_data$serverErrors = data.serverErrors) === null || _data$serverErrors === void 0 ? void 0 : _data$serverErrors.email) && /*#__PURE__*/_jsxDEV(\"div\", {\n        children: data.serverErrors.email\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 81,\n        columnNumber: 38\n      }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n        htmlFor: \"password\",\n        children: \"Password\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 84,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        id: \"password\",\n        name: \"password\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 86,\n        columnNumber: 9\n      }, this), ((_data$errors2 = data.errors) === null || _data$errors2 === void 0 ? void 0 : _data$errors2.password) && /*#__PURE__*/_jsxDEV(\"div\", {\n        children: data.errors.password\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 87,\n        columnNumber: 35\n      }, this), ((_data$serverErrors2 = data.serverErrors) === null || _data$serverErrors2 === void 0 ? void 0 : _data$serverErrors2.password) && /*#__PURE__*/_jsxDEV(\"div\", {\n        children: data.serverErrors.password\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 88,\n        columnNumber: 41\n      }, this), !isLogin && /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          htmlFor: \"name\",\n          children: \"Name\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 91,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          id: \"name\",\n          name: \"name\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 92,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true), /*#__PURE__*/_jsxDEV(\"button\", {\n        children: isLogin ? 'Login' : 'Sign up'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 7\n    }, this)\n  }, void 0, false);\n};\n_s(AuthPage, \"5u0VI8N42Fosvm5EOHVkUrp+YFA=\", false, function () {\n  return [useActionData, useLocation];\n});\n_c = AuthPage;\nexport default AuthPage;\nvar _c;\n$RefreshReg$(_c, \"AuthPage\");","map":{"version":3,"names":["React","Form","redirect","json","useActionData","useLocation","authAction","params","request","searchParams","URL","url","isLogin","get","mode","formData","data","email","password","name","errors","includes","length","Object","keys","response","fetch","method","headers","body","JSON","stringify","resData","status","ok","message","token","localStorage","setItem","expiration","Date","getTime","toISOString","user","AuthPage","location","URLSearchParams","search","serverError","serverErrors"],"sources":["/Users/cgiaramani/AEM-projects/to-do-mine/frontend/src/pages/AuthPage.js"],"sourcesContent":["import React from 'react';\nimport { Form, redirect, json, useActionData, useLocation } from 'react-router-dom';\n\nexport const authAction = async ({ params, request }) => {\n\n  let searchParams = new URL(request.url).searchParams;\n  let isLogin = searchParams.get('mode') === 'login';\n  let mode = searchParams.get('mode') === 'login' ? 'login' : 'signup';\n\n  let formData = await request.formData();\n  const data = {\n    email: formData.get('email'),\n    password: formData.get('password'),\n  };\n\n  if (formData.get('name')) {\n    data.name = formData.get('name');\n  }\n\n  const errors = {};\n\n  // validate the fields\n  if (typeof data.email !== \"string\" || !data.email.includes(\"@\")) {\n    errors.email =\n      \"That doesn't look like an email address\";\n  }\n\n  if (typeof data.password !== \"string\" || data.password.length < 6) {\n    errors.password = \"Password must be > 6 characters\";\n  }\n\n  if (Object.keys(errors).length) {\n    return errors;\n  }\n\n  let response;\n  response = await fetch('http://localhost:8080/' + mode, {\n    method: \"POST\",\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify(data),\n  })\n\n  const resData = await response.json();\n\n  if (response.status === 422 || response.status === 401) {\n    return resData;\n    // return resData.serverErrors;\n  }\n  if (!response.ok) {\n    throw json({ message: 'Could not authenticate user.' }, { status: 500 })\n  }\n\n  const token = resData.token;\n  localStorage.setItem('token', token);\n  const expiration = new Date().getTime() + 60 * 60 * 1000;\n  localStorage.setItem('token-duration', new Date(expiration).toISOString());\n  const name = resData.user.name;\n  localStorage.setItem('name', name);\n\n  // otherwise create the user and redirect\n  return redirect(\"/\");\n}\n\nconst AuthPage = () => {\n  let data = useActionData();\n\n  const location = useLocation();\n  const searchParams = new URLSearchParams(location.search);\n  let isLogin = searchParams.get('mode') === 'login';\n  // let mode = searchParams.get('mode') === 'login' ? 'login' : 'signup';\n  return (\n    <>\n      <Form method=\"post\">\n      {data?.serverError && <div>{data.serverError}</div>}\n\n        <label htmlFor='email'>Email</label>\n        <input id=\"email\" name=\"email\"></input>\n        {data.errors?.email && <div>{data.errors.email}</div>}\n        {data.serverErrors?.email && <div>{data.serverErrors.email}</div>}\n        {/* {errors[0]?.email && <div>{errors[0].email}</div>} */}\n        {/* {serverErrors?.email && <div>{serverErrors.email}</div>} */}\n        <label htmlFor='password'>Password</label>\n\n        <input id=\"password\" name=\"password\"></input>\n        {data.errors?.password && <div>{data.errors.password}</div>}\n        {data.serverErrors?.password && <div>{data.serverErrors.password}</div>}\n        {!isLogin &&\n          <>\n            <label htmlFor='name'>Name</label>\n            <input id=\"name\" name=\"name\"></input>\n          </>\n        }\n        <button>{isLogin ? 'Login' : 'Sign up'}</button>\n      </Form>\n    </>\n  )\n}\n\nexport default AuthPage;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}